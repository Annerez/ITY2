

Transport layer TCP UDP error มีอยู่สามาอย่างในการส่งข้อมูลระหว่าง ผู้ส่ง - ผู้รับ

Corrupt Data - ผู้รับตรวจเจอ (integrity check) ก็ส่งไปให้ผู้ส่งว่าข้อมูลผิด (ใช้ checksum)

Data Lost - ผู้ส่งตั้งเวลารอ x วิ ว่าข้อมูลถึงไหม ไม่ถึงส่งใหม่

Out of Order - ผู้รับ check transport header ว่าเรียงถูกป่าว 

กลไกเพื่อให้ได้มาซึ่ง Reliable Transmission

ผู้ส่งต้องรอ ACK จากผู้รับ เพื่อ Confirm การส่งสำเร็จ


Automatic Repeat Request (ARQ)

1. Stop and Wait ARQ
2. Go Back N ARQ
3. Selective Repeat ARQ


# Stop And Wait ARQ

1. ผู้ส่งจะส่งข่อมูลทีละ 1 ชุด แล้วหยุดรอ ACK จากผู้รับ
2. ผู้ส่งจะส่งข้อมูลชุดถัดไป ก็ต่อเมื่อได้รับ ACK จากผู้รับแล้ว
3. ถ้าไม่ได้รับ ACK ในเวลาที่กำหนด  (data lost / Error) ส่งข้อมูลเดิมซ้ำอีกครั้ง
4. ถ้าผู้รับได้รับข้อมูลที่ถูกต้องก็ส่ง ACK, ถ้าได้ข้อมูลผิดพลาดก็ไม่ต้องตอบ ACK


cumulative ACK - ผู้รับบอกว่าต้องการข้อมูล sequence ถัดไป เป็นลำดับต่อไป และหมายความว่าข้อมูล sequence ก่อนหน้านี้ ได้รับอย่างถูกต้องแล้ว  (Ex. send segment 0, ACK segment 1)

- ถ้าผู้ส่งยังไม่รับ ACK จะ buffer segment ปัจจุบันไว้เผื่อ retransmit

Delay ACK Error
- กรณีที่กว่าจะส่ง ACK สำเร็จ ผู้ส่งก็คิดว่า time out  ไปแล้ว แล้วส่งข้อมูลใหม่
- ผูรับถ้าได้อันผิดจะไม่ทำไร เอา ACK ส่ง ACK เก่ากลับไป

- Stop and Wait ข้อเสีย = ช้ามาก

- เหมาะกับสภาพแวดล้อมที่เน็ตที่ไม่แรงมาก และอยู่ที่ที่โดนรบกวนได้ง่าย (มี Error rate สูง)


ในระบบที่วางเครือข่ายได้ตามมาตรฐาน ( Error ต่ำ ) ต้องหาอะไรที่เร็วกว่า
" ส่งทีละหลายๆชุด แล้วค่อยรอ ACK"


การทำงานของ ARQ จะประกอบด้วย 2 component sหลัก
1. Flow Control ( ควบคุม ไม่ให้ผู้ส่งส่งข้อมูลมากเกินความสามารถของผู้รับ )
	- Stop-and-Wait -> ส่งทีละชุด
	- Go-Back-N กับ Selective Repeat -> ส่งทีละหลายๆชุด
	- Go-Back-N กับ Selective Repeat ใช้ Flow Control ชื่อว่า Sliding Window
		- ผู้ส่งและผู้รับจะมีกรอบ window ที่กำหนดความสามารถในการ รับ/ส่ง ข้อมูล
		- ในกรอบ window ฝั่งผู้ส่งจะลดลง ถ้ามีการส่งข้อมูล ออกไป และจะมีการขยายกรอบ เมื่อได้รับ ACK จากผู้รับ
		- ขนาดกรอบ Window จะอิงกับจำนวน bit ของ Sequence Number
1. Error Control
	- แต่ละ ARQ จะมีการแก้ไข Error แตกต่างกัน

# Go Back N

สมมติ sequence number = 2 bit

ส่งไปสามตัว ทีละตัว แล้วไม่ได้ ACK  หลัง 3 ตัวมาก็ส่งใหม่

ข้อเสียคือ ไม่ควรส่งใหม่หมด ส่งแค่ตัวที่มีปัญหา

# Selective Repeat

มาแก้ปัญหา Error Control ของ Go-back-N คือการแก้โดยส่งซ้ำเฉพาะข้อมูลชุดที่มีปัญหา

1. ผู้รับต้องรอรับข้อมูลมากกว่า 1 ชุด
	- กรอบ window ผู้ส่ง และผู้รับต้องทำงานสอดคล้องกัน
2. ผู้รับ ต้องมี
3. NACK


# Max Size ของกรอบ Window

Go-Back-N = 2**n - 1


